
---

# HardyBot ‚Äî Telegram IT Helpdesk Bot (Aiogram 3)

**HardyBot** ‚Äî Telegram-–±–æ—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π IT-—Å–ª—É–∂–±—ã: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –ø–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫ —Å –º–µ–¥–∏–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∞ –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è, –∏—Å—Ç–æ—Ä–∏—è –∑–∞—è–≤–æ–∫ –∏ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

–ë–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ IT-–ø–æ–¥–¥–µ—Ä–∂–∫–∏.

---

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

* –í—Ö–æ–¥ –ø–æ –æ–±—â–µ–π **—Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Ñ—Ä–∞–∑–µ** (`PASS_PHRASE`)
* –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: **–§–ò–û + SIP-–¥–æ–±–∞–≤–æ—á–Ω—ã–π**
* –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫:

  * —Ç–µ–∫—Å—Ç
  * —Ñ–æ—Ç–æ / –≤–∏–¥–µ–æ
  * –¥–æ–∫—É–º–µ–Ω—Ç—ã
  * –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
* –ò—Å—Ç–æ—Ä–∏—è –∑–∞—è–≤–æ–∫ –∏ —Ç–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã
* –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã (1‚Äì10)

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã

* –ü–æ–ª—É—á–∞—é—Ç –∑–∞—è–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–µ)
* –£–ø—Ä–∞–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å–∞–º–∏:

  * NEW / ACCEPTED / IN_PROGRESS / WAITING / CLOSED / REOPENED
* –ú–æ–≥—É—Ç –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–æ–≤—ã–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
* –§–æ—Ä–º–∏—Ä—É—é—Ç –æ—Ç—á—ë—Ç—ã

### –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å

* –ü–æ–ª—É—á–∞–µ—Ç **–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏**, –±–µ–∑ —Å–ø–∞–º–∞ –≤ —á–∞—Ç–µ
* –í–∏–¥–∏—Ç –æ–±—â—É—é –∫–∞—Ä—Ç–∏–Ω—É –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
* –ú–æ–∂–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–≤–æ–¥–Ω—ã–µ –æ—Ç—á—ë—Ç—ã

---

## üß† –õ–æ–≥–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞—è–≤–æ–∫

* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –≤ –∫–æ–¥–µ
* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è:

  * –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  * –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É **–æ—Ç–∫—Ä—ã—Ç—ã—Ö** –∑–∞—è–≤–æ–∫
* –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ç–∞—Ç—É—Å—ã:

  ```
  NEW, ACCEPTED, IN_PROGRESS, WAITING, REOPENED
  ```

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
HardyBot/
‚îú‚îÄ app/
‚îÇ  ‚îú‚îÄ bot.py              # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ  ‚îú‚îÄ config.py           # –∑–∞–≥—Ä—É–∑–∫–∞ .env
‚îÇ  ‚îú‚îÄ db.py               # SQLAlchemy (async)
‚îÇ  ‚îú‚îÄ models.py           # User, Task, Attachment
‚îÇ  ‚îú‚îÄ enums.py            # —Ä–æ–ª–∏, —Å—Ç–∞—Ç—É—Å—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
‚îÇ  ‚îú‚îÄ keyboards.py        # –≤—Å–µ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îÇ  ‚îú‚îÄ states.py           # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ  ‚îú‚îÄ telegram_safe.py    # –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å —Ä–µ—Ç—Ä–∞—è–º–∏
‚îÇ  ‚îú‚îÄ error_handlers.py   # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API
‚îÇ  ‚îú‚îÄ handlers/
‚îÇ  ‚îÇ  ‚îú‚îÄ common.py        # /start, –ø—Ä–æ—Ñ–∏–ª—å, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ  ‚îÇ  ‚îú‚îÄ user.py          # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îÇ  ‚îÇ  ‚îú‚îÄ admin.py         # –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ  ‚îÇ  ‚îî‚îÄ boss.py          # –ø–∞–Ω–µ–ª—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
‚îÇ  ‚îú‚îÄ middlewares/
‚îÇ  ‚îÇ  ‚îú‚îÄ auth.py          # –¥–æ—Å—Ç—É–ø –ø–æ —Ä–æ–ª—è–º
‚îÇ  ‚îÇ  ‚îú‚îÄ db_session.py    # AsyncSession –≤ —Ö—ç–Ω–¥–ª–µ—Ä–∞—Ö
‚îÇ  ‚îÇ  ‚îî‚îÄ antispam.py      # –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞
‚îÇ  ‚îú‚îÄ services/
‚îÇ  ‚îÇ  ‚îú‚îÄ assignment.py    # –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
‚îÇ  ‚îÇ  ‚îî‚îÄ notify.py        # —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ  ‚îî‚îÄ utils/
‚îÇ     ‚îî‚îÄ media.py         # –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –º–µ–¥–∏–∞
‚îú‚îÄ requirements.txt
‚îú‚îÄ Dockerfile
‚îú‚îÄ .env.example
‚îî‚îÄ bot.db                 # SQLite (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Python **3.11+**
* Linux / macOS / Windows

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone <repo>
cd HardyBot

python -m venv .venv
source .venv/bin/activate      # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` ‚Üí `.env`:

```env
BOT_TOKEN=123456:ABCDEF
PASS_PHRASE=secret_phrase

DB_URL=sqlite+aiosqlite:///./bot.db

ADMIN_ARTUR_ID=111111111
ADMIN_ANDREY_K_ID=222222222
BOSS_ANDREY_T_ID=333333333
```

### 4. –ó–∞–ø—É—Å–∫

```bash
python -m app.bot
```

---

## üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker build -t hardybot .
docker run --rm -it \
  --env-file .env \
  -v "$(pwd)/bot.db:/app/bot.db" \
  hardybot
```

---

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

* **SQLite** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
* ORM: **SQLAlchemy 2.x (async)**
* –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
* –ü—Ä–æ—Å—Ç—ã–µ ¬´–ª–µ–Ω–∏–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏¬ª:

  * –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ `ALTER TABLE`
* Alembic **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

---

## üîê –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø

* **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å** –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ Telegram ID –∏–∑ `.env`
* –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

  1. –í–≤–æ–¥—è—Ç `PASS_PHRASE`
  2. –ó–∞–ø–æ–ª–Ω—è—é—Ç –ø—Ä–æ—Ñ–∏–ª—å
* Middleware –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø:

  * –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ `/start` –∏ `/help`
  * –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ–±—É—é—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

---

## üõ° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* Antispam middleware (–∑–∞—â–∏—Ç–∞ –æ—Ç –∫–ª–∏–∫–æ–≤ –∏ –¥—É–±–ª–µ–π)
* –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—ã–∑–æ–≤—ã Telegram API:

  * —Ä–µ—Ç—Ä–∞–∏
  * backoff + jitter
* –ú–µ–¥–∏–∞ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –∏ –æ—á–∏—â–∞—é—Ç—Å—è, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å —á–∞—Ç
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (aiogram 3)

---

## üîß –ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ

* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞—è–≤–æ–∫:
  `app/keyboards.py ‚Üí USER_CATEGORIES`
* –õ–æ–≥–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞:
  `app/services/assignment.py`
* –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
  `app/middlewares/auth.py`
* –¢–µ–∫—Å—Ç—ã –∏ –∫–Ω–æ–ø–∫–∏:
  `app/keyboards.py`

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

* SQLite ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞
* –ù–µ—Ç Alembic-–º–∏–≥—Ä–∞—Ü–∏–π
* –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –∏ CI
* –í –∞—Ä—Ö–∏–≤–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `.venv/` ‚Äî **–Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

* PostgreSQL + `asyncpg`
* Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
* CI (lint + tests)
* Docker Compose / systemd
* –ë—ç–∫–∞–ø—ã –ë–î –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
